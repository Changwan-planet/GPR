PROGRAM INSTANT_POWER

!REAL*8, DIMENSION(4096, 109) :: BSCAN
!REAL*8, DIMENSION(4096, 109) :: HILBERT
!REAL*8, DIMENSION(4096, 109) :: INSTANT

REAL*8, DIMENSION(109,4096) :: BSCAN
REAL*8, DIMENSION(109,4096) :: HILBERT
REAL*8, DIMENSION(109,4096) :: INSTANT
REAL*8, DIMENSION(109,4096) :: INSTANT_dB

INTEGER :: X,Z




OPEN(10, FILE="/home/changwan/GPR/220506_3.PRJ/BSCAN_GPR_stacking.txt", FORM="FORMATTED",STATUS="OLD", ACTION="READ")

OPEN(11, FILE="/home/changwan/GPR/220506_3.PRJ/HILBERT_BSCAN_stacking.txt", FORM="FORMATTED",STATUS="OLD", ACTION="READ")

READ(10,*) BSCAN
READ(11,*) HILBERT

DO Z = 1, 4096
DO X = 1, 109

    INSTANT(X, Z) = SQRT(BSCAN(X,Z)**2 + HILBERT(X, Z)**2)

END DO
END DO

DO Z = 1, 4096
DO X = 1, 109

    INSTANT_dB(X,Z) = 10*LOG10(INSTANT(X, Z)/MAXVAL(INSTANT(X,:)))

END DO    
END DO

OPEN(20, FILE="/home/changwan/GPR/220506_3.PRJ/INSTANT_PowerdB_stacking.txt", FORM="FORMATTED", STATUS="REPLACE", ACTION="WRITE")


DO Z = 1, 4096

    WRITE(20,*) (INSTANT_dB(X,Z), X = 1, 109) 

END DO    

END PROGRAM INSTANT_POWER
